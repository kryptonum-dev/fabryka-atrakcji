---
export const prerender = true

import { type Language, LANGUAGES } from '@/src/global/languages'
import Breadcrumbs from '@/src/layouts/Breadcrumbs.astro'
import Layout from '@/src/layouts/Layout.astro'
import metadataFetch from '@/src/utils/metadata.fetch'
import sanityFetch from '@/src/utils/sanity.fetch'
import Content, { Content_Query, type ContentProps } from '@/src/components/legal/index.astro'
import { PortableTextQuery, type PortableTextValue } from '@/src/components/ui/portable-text'
const lang = Astro.params.lang as Language

export function getStaticPaths() {
  const translations = {
    pl: 'regulamin',
    en: 'terms-and-conditions',
  }

  return LANGUAGES.map((lang) => ({
    params: { lang, termsAndConditions: translations[lang] },
  }))
}

if (!LANGUAGES.includes(lang)) return Astro.rewrite('/404')

const page = await sanityFetch<{
  name: string
  slug: string
  heading: PortableTextValue
  content: ContentProps
}>({
  query: `
      *[_type == "TermsAndConditions_Page" && language == $language][0] {
        name,
        "slug": slug.current,
        ${PortableTextQuery('heading')}
        ${Content_Query}
      }
    `,
  params: { language: lang },
})
if (!page) return null

const metadata = await metadataFetch(page.slug)
---

<Layout {...metadata}>
  <Breadcrumbs data={[{ name: page.name, path: page.slug }]} firstItemType="Legal" />
  <Content {...page.content} heading={page.heading} />
</Layout>
