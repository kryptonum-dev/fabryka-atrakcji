---
import Image, { ImageDataQuery, type ImageDataProps } from '@/components/ui/image'
import PortableText, { PortableTextQuery, type PortableTextValue } from '@/components/ui/portable-text'

export const ImagesMarqueeSection_Query = `
  _type == "ImagesMarqueeSection" => {
    ${PortableTextQuery('heading')}
  
      ${ImageDataQuery('images[]')}
    
  },
`

type Props = {
  index: number
  sectionId?: string
  heading: PortableTextValue
  images: ImageDataProps[]
}

const { index, sectionId, heading, images } = Astro.props

// Duplicate images for seamless loop
const duplicatedImages = [...images, ...images]
---

<section class="ImagesMarqueeSection max-width" id={sectionId}>
  <PortableText value={heading} heading={index === 0 ? 'h1' : 'h2'} class="heading" />
  <div class="marquee-container">
    <div class="marquee-track">
      <div class="marquee-content">
        {
          duplicatedImages.map((image) => (
            <div class="logo-item">
              <Image
                {...image}
                sizes="(max-width: 37.4375rem) 280px, (max-width: 56.1875rem) 400px, 600px"
                loading="lazy"
              />
            </div>
          ))
        }
      </div>
    </div>
  </div>
</section>

<style lang="scss">
  .ImagesMarqueeSection {
    padding: clamp(4rem, calc(6vw / 0.48), 6rem) 0;

    .heading {
      margin: 0 auto clamp(3rem, calc(4vw / 0.48), 5rem);
      text-align: center;
      max-width: 42rem;
    }

    .marquee-container {
      position: relative;
      width: 100%;
      overflow: hidden;
      isolation: isolate;

      &::before,
      &::after {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        width: clamp(2rem, calc(4vw / 0.48), 4rem);
        z-index: 2;
        pointer-events: none;
      }

      &::before {
        left: 0;
        background: linear-gradient(90deg, var(--neutral-100, #faf7f7) 0%, transparent 100%);
      }

      &::after {
        right: 0;
        background: linear-gradient(270deg, var(--neutral-100, #faf7f7) 0%, transparent 100%);
      }
    }

    .marquee-track {
      width: 100%;
      position: relative;
      animation: marqueeScroll 30s linear infinite;
      will-change: transform;
      width: max-content;

      &:hover {
        animation-play-state: paused;

        .marquee-content {
          transform: translateX(-1rem);
        }
      }
    }

    .marquee-content {
      display: flex;
      gap: clamp(1rem, calc(1.5vw / 0.48), 2rem);

      transition: transform 800ms var(--easing);

      @media (prefers-reduced-motion: reduce) {
        animation: none;
      }
    }

    .logo-item {
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: clamp(16rem, calc(20vw / 0.48), 26rem);
      aspect-ratio: 2 / 1;
      padding: clamp(1rem, calc(1.5vw / 0.48), 1.5rem);
      background: var(--neutral-200, #f5f1ec);
      border: 1px solid var(--neutral-300, #ede6de);
      border-radius: var(--corner-radius-s);

      img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }
    }

    @keyframes marqueeScroll {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(calc(-50% - clamp(0.5rem, calc(0.75vw / 0.48), 1rem)));
      }
    }

    @media (max-width: 56.1875rem) {
      .marquee-container {
        margin-left: calc(-1 * var(--pageMargin));
        margin-right: calc(-1 * var(--pageMargin));
        width: calc(100% + var(--pageMargin) * 2);
      }
    }

    @media (max-width: 37.4375rem) {
      .marquee-content {
        animation-duration: 30s;
      }

      .logo-item {
        width: clamp(14rem, calc(18vw / 0.48), 20rem);
        height: clamp(7rem, calc(9vw / 0.48), 10rem);
      }
    }
  }
</style>
